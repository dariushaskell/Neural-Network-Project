---
title: "Predicting the Occurence of Breast Cancer Using A Neural Network Algorithm in R"
author: "Darius Haskell"
date: "June 21, 2021"
output: 
  html_document:
    code_folding: show
mainfont: Times New Roman
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Summary
***
The goal of this document is to illustrate how to implement a Neural Network (NN) algorithm in R and show its accuracy for varying amounts of hidden layer cells. To do this, we will split the breast cancer dataset into a training set and test set and then use the nnet() algorithm in the 'nnet' package to develop a predictive model. The breast cancer dataset used here was obtained from the University of Wisconsin Hospitals, Madison from Dr. William H. Wolberg.

## Exploring Neural Networks using Breast Cancer Data Set
***
```{r message = FALSE, warning = FALSE}
#Introduce Breast Cancer data set and relevant libraries
library(nnet)
library(caret)
bc = read.csv(file="BreastCancerDataset.csv", header=TRUE)
bc$bare_nuclei = as.factor(bc$bare_nuclei)
bc$class = as.factor(bc$class)
str(bc)

#Check for missing values
sum(is.na(bc))

#Normalize data for continuous variables
x <- c(1:5, 7:9)

for (i in x)
{
  variance = sqrt(var(bc[,i]))
  mu = mean(bc[,i])
  bc[,i]=(bc[,i]- mu)/variance
}
str(bc)

#Split data into training set and test set (199/500 train/test split)
train_index=sample(1:699, 199)
train = bc[train_index, 1:10]
test = bc[-train_index, 1:10]

#Run nnet() algorithm on training data with varying amounts of 
#hidden layer cells
mynn10 = nnet(class~., data=train, size=10)
mynn20 = nnet(class~., data=train, size=20)
mynn40 = nnet(class~., data=train, size=40)

#Test against test data set and record accuracy
estclass10 = predict(mynn10, test, type="class")
estclass20 = predict(mynn20, test, type="class")
estclass40 = predict(mynn40, test, type="class")

```
## Measuring Accuracy
***
```{r class.source = "fold-hide", eval = TRUE}

#convert from chr to factor
estclass10_factor <- as.factor(estclass10) 

#create confusion matrix for 10 hidden layer cells
cm1 <- confusionMatrix(data = estclass10_factor, reference = test$class)

draw_confusion_matrix <- function(cm) {

  layout(matrix(c(1,1,2)))
  par(mar=c(2,2,2,2))
  plot(c(100, 345), c(300, 450), type = "n", xlab="", ylab="", xaxt='n', yaxt='n')
  title('10 Hidden Layer Cells', cex.main=2)

  # create the matrix 
  rect(150, 430, 240, 370, col='#3F97D0')
  text(195, 435, '0', cex=1.2)
  rect(250, 430, 340, 370, col='#F7AD50')
  text(295, 435, '1', cex=1.2)
  text(115, 370, 'Predicted', cex=1.3, font=2)
  text(245, 450, 'Actual', cex=1.3, font=2)
  rect(150, 305, 240, 365, col='#F7AD50')
  rect(250, 305, 340, 365, col='#3F97D0')
  text(140, 400, '0', cex=1.2)
  text(140, 335, '1', cex=1.2)

  # add in the cm results 
  res <- as.numeric(cm$table)
  text(195, 400, res[1], cex=1.6, font=2, col='white')
  text(195, 335, res[2], cex=1.6, font=2, col='white')
  text(295, 400, res[3], cex=1.6, font=2, col='white')
  text(295, 335, res[4], cex=1.6, font=2, col='white')

  # add in the specifics 
  plot(c(100, 0), c(100, 0), type = "n", xlab="", ylab="", main = "DETAILS", xaxt='n', yaxt='n')
  text(10, 85, names(cm$byClass[1]), cex=1.2, font=2)
  text(10, 70, round(as.numeric(cm$byClass[1]), 3), cex=1.2)
  text(30, 85, names(cm$byClass[2]), cex=1.2, font=2)
  text(30, 70, round(as.numeric(cm$byClass[2]), 3), cex=1.2)
  text(50, 85, names(cm$byClass[5]), cex=1.2, font=2)
  text(50, 70, round(as.numeric(cm$byClass[5]), 3), cex=1.2)
  text(70, 85, names(cm$byClass[6]), cex=1.2, font=2)
  text(70, 70, round(as.numeric(cm$byClass[6]), 3), cex=1.2)
  text(90, 85, names(cm$byClass[7]), cex=1.2, font=2)
  text(90, 70, round(as.numeric(cm$byClass[7]), 3), cex=1.2)

  # add in the accuracy information 
  text(30, 35, names(cm$overall[1]), cex=1.5, font=2)
  text(30, 20, round(as.numeric(cm$overall[1]), 3), cex=1.4)
  text(70, 35, names(cm$overall[2]), cex=1.5, font=2)
  text(70, 20, round(as.numeric(cm$overall[2]), 3), cex=1.4)
}  

draw_confusion_matrix(cm1)
```

```{r class.source = "fold-hide", eval = TRUE}
#convert from chr to factor
estclass20_factor <- as.factor(estclass20) 

#create confusion matrix for 20 hidden layer cells
cm2 <- confusionMatrix(data = estclass20_factor, reference = test$class)

draw_confusion_matrix <- function(cm) {

  layout(matrix(c(1,1,2)))
  par(mar=c(2,2,2,2))
  plot(c(100, 345), c(300, 450), type = "n", xlab="", ylab="", xaxt='n', yaxt='n')
  title('20 Hidden Layer Cells', cex.main=2)

  # create the matrix 
  rect(150, 430, 240, 370, col='#3F97D0')
  text(195, 435, '0', cex=1.2)
  rect(250, 430, 340, 370, col='#F7AD50')
  text(295, 435, '1', cex=1.2)
  text(115, 370, 'Predicted', cex=1.3, font=2)
  text(245, 450, 'Actual', cex=1.3, font=2)
  rect(150, 305, 240, 365, col='#F7AD50')
  rect(250, 305, 340, 365, col='#3F97D0')
  text(140, 400, '0', cex=1.2)
  text(140, 335, '1', cex=1.2)

  # add in the cm results 
  res <- as.numeric(cm$table)
  text(195, 400, res[1], cex=1.6, font=2, col='white')
  text(195, 335, res[2], cex=1.6, font=2, col='white')
  text(295, 400, res[3], cex=1.6, font=2, col='white')
  text(295, 335, res[4], cex=1.6, font=2, col='white')

  # add in the specifics 
  plot(c(100, 0), c(100, 0), type = "n", xlab="", ylab="", main = "DETAILS", xaxt='n', yaxt='n')
  text(10, 85, names(cm$byClass[1]), cex=1.2, font=2)
  text(10, 70, round(as.numeric(cm$byClass[1]), 3), cex=1.2)
  text(30, 85, names(cm$byClass[2]), cex=1.2, font=2)
  text(30, 70, round(as.numeric(cm$byClass[2]), 3), cex=1.2)
  text(50, 85, names(cm$byClass[5]), cex=1.2, font=2)
  text(50, 70, round(as.numeric(cm$byClass[5]), 3), cex=1.2)
  text(70, 85, names(cm$byClass[6]), cex=1.2, font=2)
  text(70, 70, round(as.numeric(cm$byClass[6]), 3), cex=1.2)
  text(90, 85, names(cm$byClass[7]), cex=1.2, font=2)
  text(90, 70, round(as.numeric(cm$byClass[7]), 3), cex=1.2)

  # add in the accuracy information 
  text(30, 35, names(cm$overall[1]), cex=1.5, font=2)
  text(30, 20, round(as.numeric(cm$overall[1]), 3), cex=1.4)
  text(70, 35, names(cm$overall[2]), cex=1.5, font=2)
  text(70, 20, round(as.numeric(cm$overall[2]), 3), cex=1.4)
}  

draw_confusion_matrix(cm2)
```

```{r class.source = "fold-hide", eval = TRUE}
#convert from chr to factor
estclass40_factor <- as.factor(estclass40) 

#create confusion matrix for 40 hidden layer cells
cm3 <- confusionMatrix(data = estclass40_factor, reference = test$class)
draw_confusion_matrix <- function(cm) {

  layout(matrix(c(1,1,2)))
  par(mar=c(2,2,2,2))
  plot(c(100, 345), c(300, 450), type = "n", xlab="", ylab="", xaxt='n', yaxt='n')
  title('40 Hidden Layer Cells', cex.main=2)

  # create the matrix 
  rect(150, 430, 240, 370, col='#3F97D0')
  text(195, 435, '0', cex=1.2)
  rect(250, 430, 340, 370, col='#F7AD50')
  text(295, 435, '1', cex=1.2)
  text(115, 370, 'Predicted', cex=1.3, font=2)
  text(245, 450, 'Actual', cex=1.3, font=2)
  rect(150, 305, 240, 365, col='#F7AD50')
  rect(250, 305, 340, 365, col='#3F97D0')
  text(140, 400, '0', cex=1.2)
  text(140, 335, '1', cex=1.2)

  # add in the cm results 
  res <- as.numeric(cm$table)
  text(195, 400, res[1], cex=1.6, font=2, col='white')
  text(195, 335, res[2], cex=1.6, font=2, col='white')
  text(295, 400, res[3], cex=1.6, font=2, col='white')
  text(295, 335, res[4], cex=1.6, font=2, col='white')

  # add in the specifics 
  plot(c(100, 0), c(100, 0), type = "n", xlab="", ylab="", main = "DETAILS", xaxt='n', yaxt='n')
  text(10, 85, names(cm$byClass[1]), cex=1.2, font=2)
  text(10, 70, round(as.numeric(cm$byClass[1]), 3), cex=1.2)
  text(30, 85, names(cm$byClass[2]), cex=1.2, font=2)
  text(30, 70, round(as.numeric(cm$byClass[2]), 3), cex=1.2)
  text(50, 85, names(cm$byClass[5]), cex=1.2, font=2)
  text(50, 70, round(as.numeric(cm$byClass[5]), 3), cex=1.2)
  text(70, 85, names(cm$byClass[6]), cex=1.2, font=2)
  text(70, 70, round(as.numeric(cm$byClass[6]), 3), cex=1.2)
  text(90, 85, names(cm$byClass[7]), cex=1.2, font=2)
  text(90, 70, round(as.numeric(cm$byClass[7]), 3), cex=1.2)

  # add in the accuracy information 
  text(30, 35, names(cm$overall[1]), cex=1.5, font=2)
  text(30, 20, round(as.numeric(cm$overall[1]), 3), cex=1.4)
  text(70, 35, names(cm$overall[2]), cex=1.5, font=2)
  text(70, 20, round(as.numeric(cm$overall[2]), 3), cex=1.4)
}  
draw_confusion_matrix(cm3)
```

## Conclusion
***

From the preceding analysis, we can see the power that neural network algorithms have to offer. The original breast cancer data set contains 699 observations of 10 variables. Our target variable 'class' is binary variable with 0 and 1 being the possible options. The data was split into a training set and test set with a 30-70 percent split respectively. The training data was then passed into the nnet() algorithm with varying amounts of hidden layer cells. We see a approximately equal performance across all three models which implies that 10 hidden layer cells is enough to produce an accurate model without wasting computational power. 